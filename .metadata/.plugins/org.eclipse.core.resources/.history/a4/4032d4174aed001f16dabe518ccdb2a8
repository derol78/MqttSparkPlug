package org.sample.mavensample;
import org.eclipse.paho.client.mqttv3.MqttClient;
import org.eclipse.paho.client.mqttv3.MqttException;
import org.eclipse.paho.client.mqttv3.MqttMessage;
import org.eclipse.tahu.message.SparkplugBPayload;
import org.eclipse.tahu.protobuf.Payload;

public class SparkplugMqttPublisher {

    public static void main(String[] args) {
        String broker = "tcp://broker.hivemq.com:1883"; // Change to your MQTT broker URL
        String clientId = "SparkplugJavaPublisher";
        String topic = "spBv1.0/myGroup/NBIRTH/myNode"; // Change to your Sparkplug topic

        try {
            // Create an MQTT client
            MqttClient mqttClient = new MqttClient(broker, clientId);

            // Connect to the MQTT broker
            mqttClient.connect();

            // Create a Sparkplug B payload
            SparkplugBPayload.Builder payloadBuilder = SparkplugBPayload.newBuilder();
            payloadBuilder.setTimestamp(System.currentTimeMillis());
            payloadBuilder.addMetrics(Payload.Metric.newBuilder().setName("temperature").setValue(Payload.DataType.Double, 22.5).build());

            // Build the payload
            SparkplugBPayload payload = payloadBuilder.build();

            // Convert the Sparkplug payload to a byte array
            byte[] payloadBytes = payload.toByteArray();

            // Create an MQTT message with the Sparkplug payload
            MqttMessage mqttMessage = new MqttMessage(payloadBytes);

            // Publish the message to the Sparkplug topic
            mqttClient.publish(topic, mqttMessage);

            // Disconnect from the MQTT broker
            mqttClient.disconnect();

            System.out.println("Message published to topic: " + topic);

        } catch (MqttException e) {
            e.printStackTrace();
        }
    }
}
